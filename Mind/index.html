<!DOCTYPE html>
<head>
<title>Easy or Mind Control</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="main.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script type="text/javascript" src="jquery-3.3.1.min.js"></script>
</head>
<body>
<font id="title">Easy or Mind Control</font><p><br>
<div>
  <table width="200" align="center">
    <tr>
      <td><label>
        <input type="radio" name="control method" value="bluete" id="controlmethod_0" checked>
        藍芽</label></td>
		<td><label>
        <input type="radio" name="control method" value="mind" id="controlmethod_1">
        腦波</label></td>
    
      <td>版號 1</td>
    </tr>
	  <tr>
	  <td id="mid1">	Q	  </td>
      <td id="mid2">	Q	  </td>
		  <td id="mid3">	Q	  </td>
	  </tr>
  </table>
</div>
<div align="center"><table style="margin: 0 auto; margin-top: 10px;"><tr><td>專注等級</td><td id="Mindstate">0</td></tr></table></div>
<div id="content" class="row">
	<div class="col-sm-12  col-xs-12">
		<div id="analog" class="col-sm-6 col-xs-12">
			<div class="analogclass">
				<img class="analogsensor" src="img/light.png" />
				<span class="analogvalue" id="lightvalue">none</span><br>
			</div>
			<p>
			<div class="analogclass">
				<img class="analogsensor" src="img/temp.png" />
				<span class="analogvalue" id="temperaturevalue">none</span>
			</div>
		</div>
		<div id="rgb" class="col-sm-6 col-xs-12">
			
			
			<table style="margin: 0 auto; margin-top: 10px;">
				<tr style="text-align: center;">
					<td><img class="rgbled" src="img/rgb.png" /></td>
					<td><img class="rgbled" src="img/rgb.png" /></td>
					<td><img class="rgbled" src="img/rgb.png" /></td>
					<td><img class="rgbled" src="img/fan.png" style="background-color:black;"/></td>
				</tr>
				<tr style="text-align: center;">
					<td><font color="red"><b>Red</b></font></td>
					<td><font color="green"><b>Green</b></font></td>
					<td><font color="blue"><b>Blue</b></font></td>
					<td><font color="dark"><b>Fan</b></font></td>
				</tr>
				<tr style="text-align: center;">
					<td id="redvalue">0</td>
					<td id="greenvalue">0</td>
					<td id="bluevalue">0</td>
					<td id="fanvalue">0</td>
					
				</tr>
				
				<tr>
					
					<td><input Onchange="changeColor();" type="range" id="rled" class="ledbar" value="0" min="0" max="255"></td>
					<td><input Onchange="changeColor();" type="range" id="gled" class="ledbar" value="0" min="0" max="255"></td>
					<td><input Onchange="changeColor();" type="range" id="bled" class="ledbar" value="0" min="0" max="255"></td>
					<td><input Onchange="fan();" type="range" id="fanspeed" class="ledbar" value="0" min="0" max="255"></td>
				</tr>
			</table>
			<span id="showcolor"></span>
		</div>
	</div>
<div>
	<div class="output">
			<div class="output_title">
				<h2 style="margin-top: 5px;">Lighting</h2>
			</div>
			<hr style="margin-top: 0px;">
			<div class="output_img">
				<img src="./img/bulb.png" id="bulb" class="sensors" style="width: 10%; top: 5%;background-color:black;">
			</div>
			<div class="output_content">
				<img src="./img/lighton.png" class="lighting" id="lighton" style="width: 10%; top: 5%;">
				<img src="./img/light_off.png" class="lighting" id="lightoff" style="width: 10%; top: 5%;">
			</div>
		</div>
		
	
	</div>
</div>

<script>
	
	var lightdata;
	var tempdata;
	var celsius;
	var lighton = document.getElementById("lighton");
	var lightoff = document.getElementById("lightoff");
	var mind1;
	var mind2;
	var mind3;
	var mindstate
	setup();
	// Analog
	function loop() {
		if(cpf){
	
			lightdata = cpf.get("light sensor");
			tempdata = cpf.get("temperature sensor");
			mind1=cpf.get("d4");
			mind2=cpf.get("d5");
			mind3=cpf.get("d6");
		}
			celsius = toCelsius(tempdata);	
			document.getElementById("lightvalue").innerHTML = lightdata;
			document.getElementById("temperaturevalue").innerHTML = celsius;
			
			document.getElementById("mid1").innerHTML = mind1 ;
				document.getElementById("mid2").innerHTML = mind2;
				document.getElementById("mid3").innerHTML = mind3;
				if(mind1==1 && mind2==0 && mind3==0)
				{
					mindstate="非常好";
				 if(cpf){
			cpf.setChainableLed("0," + 0 + "," + 255 + "," + 0 + ";");
				 }
			document.getElementById("Mindstate").innerHTML = mindstate;
				}
		
		setTimeout(loop, 1000);
	}
	}
	loop();
	
	// RGB
	function changeColor() {
		var Rled = document.getElementById("rled").value;
		var Gled = document.getElementById("gled").value;
		var Bled = document.getElementById("bled").value;
		
		document.getElementById("redvalue").innerHTML = Rled;
		document.getElementById("greenvalue").innerHTML = Gled;
		document.getElementById("bluevalue").innerHTML = Bled;
		
		document.getElementById("showcolor").style.backgroundColor = 'rgb(' + Rled + ',' + Gled + ',' + Bled + ')';
		
		if(cpf){
			cpf.setChainableLed("0," + Rled + "," + Gled + "," + Bled + ";");
		}
		
	}
	//fan
	function fan() {
		var Fanspeed = document.getElementById("fanspeed").value;
		document.getElementById("fanvalue").innerHTML = Fanspeed;
		cpf.request('["analogWrite", 3, ' + Fanspeed + ']');
		
	}
	// LED開燈
	lighton.addEventListener('touchstart', function(event) {
		lighton.src= './img/light_on.png';
		lightoff.src= './img/lightoff.png';
		cpf.request('["digitalWrite", 2 , 1]');
	});
	// LED關燈
	lightoff.addEventListener('touchstart', function(event) {
		lightoff.src= './img/light_off.png';
		lighton.src= './img/lighton.png';
		cpf.request('["digitalWrite", 2 , 0]');
	});
	// Temperature
	function toCelsius(value) {
		var resistance = parseFloat((1023-value) * 10000 / value);
		var temperature = 1 / (Math.log(resistance / 10000) / 3975+1 / 298.15) - 273.15;
		
		return temperature.toFixed(2);
	}
	
	// cpf setup
	function setup(){
		if(cpf)
			cpf.setPinMode('["resetPin"],["setPinMode", "analog", 0, "INPUT"],["setPinMode", "analog", 1,"INPUT"],["grove_newChainableLED", 7, 8, 1],["setPinMode", "digital", 2,"OUTPUT"],["setPinMode", "digital", 3,"PWM"],["setPinMode", "digital", 4,"INPUT"],["setPinMode", "digital", 5,"INPUT"],["setPinMode", "digital", 6,"INPUT"]'); 
			//document.getElementById("demo").innerHTML += ret + "<br>";
	}
	
</script>
</body>
</html>
